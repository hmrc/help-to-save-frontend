@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.helptosavefrontend.forms.BankDetails
@import uk.gov.hmrc.helptosavefrontend.views.html.helpers
@import uk.gov.hmrc.helptosavefrontend.models.HtsContext
@import uk.gov.hmrc.helptosavefrontend.config.FrontendAppConfig
@import uk.gov.hmrc.helptosavefrontend.views.register.BankDetailsErrors
@import uk.gov.hmrc.helptosavefrontend.views.html.helpers._
@import uk.gov.hmrc.helptosavefrontend.controllers.routes
@import uk.gov.hmrc.helptosavefrontend.views.ViewHelpers
@import uk.gov.hmrc.govukfrontend.views.html.components._

@this(layout: uk.gov.hmrc.helptosavefrontend.views.html.layout, viewHelpers: ViewHelpers)

@(form: Form[BankDetails], backLink: String)(implicit htsContext: HtsContext, request: Request[_], messages: Messages, appConfig: FrontendAppConfig)

@title = @{messages("hts.register.bank-details.title.h1")}
@sortCodeErrorMessage = @{BankDetailsErrors.getErrorMessage(form, "sortCode")}
@accountNumberErrorMessage = @{BankDetailsErrors.getErrorMessage(form, "accountNumber")}
@rollNumberErrorMessage = @{BankDetailsErrors.getErrorMessage(form, "rollNumber")}
@accountNameErrorMessage = @{BankDetailsErrors.getErrorMessage(form, "accountName")}
@hasErrors = @{form.hasErrors || form.hasGlobalErrors}
@pageTitle = @{if(hasErrors) messages("hts.global.error.prefix") + " " + title else title}

@sortCodeBackendErrorMessage = @{BankDetailsErrors.getBankDetailsBackendErrorMessage(form, "sortCode")}
@accountNumberBackendErrorMessage = @{BankDetailsErrors.getBankDetailsBackendErrorMessage(form, "accountNumber")}

@layout(pageTitle) {

  @navigate_back(Some(backLink))

  @if(hasErrors) {
      @defining(List(
          "sortCode" → sortCodeErrorMessage,
          "sortCode" → sortCodeBackendErrorMessage,
          "accountNumber" → accountNumberErrorMessage,
          "accountNumber" → accountNumberBackendErrorMessage,
          "rollNumber" → rollNumberErrorMessage,
          "accountName" → accountNameErrorMessage
      ).collect{ case (name, Some(s)) ⇒ name → s }
      ){ errors =>
          <div class="govuk-error-summary" data-module="govuk-error-summary" id="error-summary-display"
               aria-labelledby="error-summary-heading"
               tabindex="-1">
              <div role="alert">
              <h2 id="error-summary-heading" class="govuk-error-summary__title">@Messages("hts.global.error-summary.title")</h2>
                  <div class="govuk-error-summary__body">

                  <ul class="govuk-list govuk-error-summary__list">
              @for(error <- errors) {
                  <li><a href="#@error._1" data-focuses="@error._1">@error._2</a></li>
              }
              </ul>
                  </div>
              </div>
          </div>
      }
  }

  <h1 class="govuk-heading--l">@title</h1>

  @helpers.form(routes.BankAccountController.submitBankDetails, 'id -> "bankDetailsForm") {


    @viewHelpers.govukInput(Input(
    id = "sortCode",
    name = "sortCode",
    label = Label(
    isPageHeading = false,
    classes = "govuk-label--xs",
    content = Text(messages("hts.register.bank-details.sort-code.label"))
    ),
    classes = "govuk-!-width-one-third",
    value = form.data.get("sortCode"),
    hint = Some(Hint(
    content = Text(Messages("hts.register.bank-details.sort-code.hint")),
    )),
    errorMessage = if(sortCodeErrorMessage)Some(ErrorMessage(
    content = Text(messages("hts.sort-code.empty"))
    )) else None,
    ))

    @viewHelpers.govukInput(Input(
    id = "accountNumber",
    name = "accountNumber",
    label = Label(
    isPageHeading = false,
    classes = "govuk-label--xs",
    content = Text(messages("hts.register.bank-details.accountNumber.label"))
    ),
    classes = "govuk-!-width-one-third",
    value = form.data.get("accountNumber"),
    hint = Some(Hint(
    content = Text(Messages("hts.register.bank-details.accountNumber.hint")),
    )),
    errorMessage = if(accountNumberErrorMessage)Some(ErrorMessage(
    content = Text(messages("hts.account-number.empty"))
    )) else None,
    ))

    @viewHelpers.govukInput(Input(
    id = "rollNumber",
    name = "rollNumber",
    label = Label(
    isPageHeading = false,
    classes = "govuk-label--xs",
    content = Text(messages("hts.register.bank-details.rollNumber.label"))
    ),
    classes = "govuk-!-width-one-third",
    value = form.data.get("rollNumber"),
    hint = Some(Hint(
    content = Text(Messages("hts.register.bank-details.rollNumber.hint")),
    ))
    ))

    @viewHelpers.govukInput(Input(
    id = "accountName",
    name = "accountName",
    label = Label(
    isPageHeading = false,
    classes = "govuk-label--xs",
    content = Text(messages("hts.register.bank-details.accountName.label"))
    ),
    classes = "govuk-!-width-one-third",
    value = form.data.get("accountName"),
    errorMessage = if(accountNumberErrorMessage)Some(ErrorMessage(
    content = Text(messages("hts.account-name.empty"))
    )) else None,
    ))

    @viewHelpers.govukButton(Button(
    content = Text(Messages("hts.global.continue-button"))
    ))
  }
}